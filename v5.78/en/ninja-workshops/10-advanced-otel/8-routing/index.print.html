<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=generator content="Relearn 7.2.1"><meta name=description content="The Routing Connector in OpenTelemetry is a powerful feature that allows you to direct data (traces, metrics, or logs) to different pipelines based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.
For example, you might want to send production data to one exporter while directing test or development data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="8. Routing :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="The Routing Connector in OpenTelemetry is a powerful feature that allows you to direct data (traces, metrics, or logs) to different pipelines based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.
For example, you might want to send production data to one exporter while directing test or development data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.78/en/ninja-workshops/10-advanced-otel/8-routing/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="8. Routing :: Splunk Observability Cloud Workshops"><meta property="og:description" content="The Routing Connector in OpenTelemetry is a powerful feature that allows you to direct data (traces, metrics, or logs) to different pipelines based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.
For example, you might want to send production data to one exporter while directing test or development data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="8. Routing :: Splunk Observability Cloud Workshops"><meta itemprop=description content="The Routing Connector in OpenTelemetry is a powerful feature that allows you to direct data (traces, metrics, or logs) to different pipelines based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.
For example, you might want to send production data to one exporter while directing test or development data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic."><meta itemprop=dateModified content="2025-02-05T16:16:08+00:00"><meta itemprop=wordCount content="177"><title>8. Routing :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.78/en/ninja-workshops/10-advanced-otel/8-routing/index.html rel=canonical type=text/html title="8. Routing :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.78/images/favicon.ico?1738773632 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.78/css/fontawesome-all.min.css?1738773632 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.78/css/fontawesome-all.min.css?1738773632 rel=stylesheet></noscript><link href=/observability-workshop/v5.78/css/auto-complete.css?1738773632 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.78/css/auto-complete.css?1738773632 rel=stylesheet></noscript><link href=/observability-workshop/v5.78/css/perfect-scrollbar.min.css?1738773632 rel=stylesheet><link href=/observability-workshop/v5.78/css/theme.min.css?1738773632 rel=stylesheet><link href=/observability-workshop/v5.78/css/format-print.min.css?1738773632 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../..",window.relearn.relBaseUri="../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.78",window.relearn.min=`.min`,window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}}))},window.relearn.markVariant=function(){var t=window.localStorage.getItem(window.relearn.absBaseUri+"/variant"),e=document.querySelector("#R-select-variant");e&&(e.value=t)},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant(),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA"})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.78/en/ninja-workshops/10-advanced-otel/8-routing/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><ul><li><a href=#setup>Setup</a></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.78/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.78/en/ninja-workshops/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.78/en/ninja-workshops/10-advanced-otel/index.html><span itemprop=name>Advanced OpenTelemetry</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>8. Routing</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.78/en/ninja-workshops/10-advanced-otel/8-routing/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.78/en/ninja-workshops/10-advanced-otel/7-transform-data/7-1-test-transform/index.html title="7.1 Test Transform Processor (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.78/en/ninja-workshops/10-advanced-otel/8-routing/8-1-connector/index.html title="8.1 Configuring the Routing Connector (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable ninja-workshops" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=8-routing>8. Routing</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/routingconnector rel=external target=_blank><strong>Routing Connector</strong></a> in OpenTelemetry is a powerful feature that allows you to direct data (<code>traces</code>, <code>metrics</code>, or <code>logs</code>) to different pipelines based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.</p><p>For example, you might want to send <em>production</em> data to one exporter while directing <em>test</em> or <em>development</em> data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic.</p><h3 id=setup>Setup</h3><p>Create a new subdirectory named <code>8-routing</code> and copy all contents from the <code>7-transform-data</code> directory into it. Then, delete any <code>*.out</code> and <code>*.log</code> files. Your updated directory structure should now look like this:</p><div class=tab-panel data-tab-group=962fb392452e99ac00ae26ccfc7f3102><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("962fb392452e99ac00ae26ccfc7f3102","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>├── 1-agent
</span></span><span class=line><span class=cl>├── 2-gateway
</span></span><span class=line><span class=cl>├── 3-filelog
</span></span><span class=line><span class=cl>├── 4-resilience
</span></span><span class=line><span class=cl>├── 5-dropping-spans
</span></span><span class=line><span class=cl>├── 6-sensitive-data
</span></span><span class=line><span class=cl>├── 7-transform-data
</span></span><span class=line><span class=cl>├── 8-routing
</span></span><span class=line><span class=cl>│   ├── agent.yaml
</span></span><span class=line><span class=cl>│   ├── health.json
</span></span><span class=line><span class=cl>│   ├── gateway.yaml
</span></span><span class=line><span class=cl>│   ├── log-gen.sh (or .ps1)
</span></span><span class=line><span class=cl>│   └── trace.json
</span></span><span class=line><span class=cl>└── otelcol</span></span></code></pre></div></div></div></div></div><p>Next, we will configure the routing connector and the respective pipelines.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 5, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 8. Routing</h1><article class=default><header class=headline></header><h1 id=81-configuring-the-routing-connector>8.1 Configuring the Routing Connector</h1><p>In the following exercise, you will configure the <code>routing</code> connector in the <code>gateway.yaml</code> file. This setup will enable the <strong>Gateway</strong> to route traces based on the <code>deployment.environment</code> attribute in the spans you send. By doing so, you can process and handle traces differently depending on their attributes.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Open the <code>gateway.yaml</code> and add the following configuration:</p><ul><li><p><strong>Add the <code>routing</code> connector</strong>: In OpenTelemetry configuration files, <code>connectors</code> have their own dedicated section, similar to receivers and processors in the <code>gateway.yaml</code> file. This same approach can also be applied to <code>metrics</code> and <code>logs</code>, allowing you to route them based on attributes in <code>resourceMetrics</code> or <code>resourceLogs</code> similarly.</p><p>Add the following below the <code>receivers:</code> section and above the <code>processors:</code> section:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>connectors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>routing</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>default_pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/standard]</span><span class=w> </span><span class=c># Default pipeline to use if no matching rule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore                  </span><span class=w> </span><span class=c># Ignore errors in the routing </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>table</span><span class=p>:</span><span class=w>                               </span><span class=c># Array with routing rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Connector will route any span to target pipeline if if the resourceSpn attribute matches this rule </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>statement</span><span class=p>:</span><span class=w> </span><span class=l>route() where attributes[&#34;deployment.environment&#34;] == &#34;security_applications&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/security]    </span><span class=w> </span><span class=c># Target pipeline </span></span></span></code></pre></div></li><li><p><strong>Configure two <code>file:</code> Exporters</strong>:
The <code>routing</code> connector requires different targets for routing. Add a second and third file exporter called <code>file/traces/security:</code> and <code>file/traces/standard:</code> respectively. This will allow the routing connector to direct data to the appropriate target based on the rules you define:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces/standard</span><span class=p>:</span><span class=w>              </span><span class=c># Exporter Type/Name (For regular traces)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Path where trace data will be saved in OTLP json format </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces-standard.out&#34;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>    </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces/security</span><span class=p>:</span><span class=w>              </span><span class=c># Exporter Type/Name (For security traces)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Path where trace data will be saved in OTLP json format</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces-security.out&#34;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                    </span><span class=c># Overwrite the file each time </span></span></span></code></pre></div></li></ul></div></details><p>With the <code>routing</code> configuration complete, next we configure the <code>pipelines</code> to use the routing rules.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 5, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=82-configuring-the-pipelines>8.2 Configuring the Pipelines</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li><p><strong>Add both the <code>standard</code> and <code>security</code> traces pipelines</strong>:</p><ol><li><strong>Standard pipeline</strong>: This pipeline will handle all spans that do not match the routing rule. Add it below the regular <code>traces:</code> pipeline, and leave the configuration unchanged for now.</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/standard</span><span class=p>:</span><span class=w>                </span><span class=c># New Default Traces/Spans Pipeline    </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                    </span><span class=w> </span><span class=c># Routing Connector, Only receives data from Connector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter             </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode          </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                      </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces/standard       </span><span class=w> </span><span class=c># File Exporter for spans NOT matching rule</span></span></span></code></pre></div><ul><li><strong>Target pipeline</strong>: This pipeline will handle all spans that match the routing rule.</li></ul><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/security</span><span class=p>:</span><span class=w>                </span><span class=c># New Security Traces/Spans Pipeline       </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                    </span><span class=w> </span><span class=c># Routing Connector, Only receives data from Connector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter             </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode          </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                      </span><span class=w> </span><span class=c># Debug Exporter </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces/security       </span><span class=w> </span><span class=c># File Exporter for spans matching rule</span></span></span></code></pre></div></li><li><p><strong>Update the <code>traces</code> pipeline to use routing</strong>: To enable <code>routing</code>, update the original <code>traces:</code> pipeline by adding <code>routing</code> as an exporter. This ensures that all span data is sent through the routing connector for evaluation.</p></li></ul><p>For clarity, we are removing the <code>debug</code> exporter from this pipeline, so that debug output is only shown from the new exporters behind the routing connector.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>                           </span><span class=c># Original traces pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                         </span><span class=w> </span><span class=c># Debug Exporter            </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                      </span><span class=w> </span><span class=c># Routing Connector, Only exports data to Connector</span></span></span></code></pre></div><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>Keep in mind that any existing processors have been removed from this pipeline. They are now handled by either the standard pipeline or the target pipelines, depending on the routing rules.</p><p>Additionally, the <code>batch</code> processor has been removed from the new pipelines. This ensures that <code>spans</code> are written immediately, rather than waiting for multiple spans to arrive before processing. This change speeds up the workshop and allows you to see results faster.</p></div></details></div></details><p>Again, validate the <strong>Gateway</strong> configuration using <code>otelbin.io</code> for spelling mistakes etc. Your <code>Traces:</code> pipeline should like this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip):::processor
      PRO4(resource&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;emsp;&amp;emsp;file&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload):::exporter
      EXP3(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP4(&amp;emsp;&amp;emsp;file&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload):::exporter
      ROUTE1(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-export
      ROUTE2(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-receive
      ROUTE3(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-receive
    %% Links
    subID1:::sub-traces
    subID2:::sub-traces
    subID3:::sub-traces
    subgraph &#34; &#34;
    direction LR
      subgraph subID1[**Traces**]
      REC1 --&gt; ROUTE1
      end
      subgraph subID2[**Traces/standard**]
      ROUTE1 --&gt; ROUTE2
      ROUTE2 --&gt; PRO1
      PRO1 --&gt; PRO3
      PRO3 --&gt; EXP1
      PRO3 --&gt; EXP2
      end
      subgraph subID3[**Traces/security**]
      ROUTE1 --&gt; ROUTE3
      ROUTE3 --&gt; PRO2
      PRO2 --&gt; PRO4
      PRO4 --&gt; EXP3
      PRO4 --&gt; EXP4
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><p>Lets&rsquo; test our configuration!</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 5, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=83-test-routing-connector>8.3 Test Routing Connector</h1><h3 id=setup-test>Setup Test</h3><p>In this section, we will test the <code>routing</code> rule configured for the <strong>Gateway</strong>. The expected result is that the<code>span</code> from the <code>security.json</code> file will be sent to the <code>gateway-traces-security.out</code> file.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li><p><strong>Run the Gateway</strong>:
Find your <strong>Gateway</strong> terminal window, and navigate to the <code>[WORKSHOP]/8-routing</code> directory and restart the gateway with the routing configurations specified in the gateway.yaml.<br>It should start up normally and state : <code>Everything is ready. Begin running and processing data.</code></p></li><li><p><strong>Run the Agent</strong>:
Find your <strong>Agent</strong> terminal window and navigate to the <code>[WORKSHOP]/8-routing</code> directory and restart the agent with the regular <code>agent.yaml</code>.<br>It should also start up normally and state : <code>Everything is ready. Begin running and processing data.</code></p></li><li><p><strong>Create a trace for different Environments</strong>
Find your <strong>Tests</strong> terminal window and navigate to the <code>[WORKSHOP]/8-routing</code>.<br>To test your configuration, you need to generate span data with the correct <code>ResourceSpan</code> attributes to trigger the routing rule. Copy the following JSON and save it as <code>security.json</code> in the <code>[WORKSHOP]/8-routing</code> directory.</p></li></ul><div class=tab-panel data-tab-group=a36e3091216bd0e639ee81d564c6433a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=compacted-json class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a36e3091216bd0e639ee81d564c6433a","compacted-json")'>
<span class=tab-nav-text>Compacted JSON</span>
</button>
<button data-tab-item=formatted-json class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("a36e3091216bd0e639ee81d564c6433a","formatted-json")'>
<span class=tab-nav-text>Formatted JSON</span></button></div><div class=tab-content-container><div data-tab-item=compacted-json class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;service.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;password_check&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;security_applications&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;my.library&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some scope attribute&#34;</span><span class=p>}}]},</span><span class=nt>&#34;spans&#34;</span><span class=p>:[{</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;5B8EFFF798038103D269B633813FC60C&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B174&#34;</span><span class=p>,</span><span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B173&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span><span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;keytest&#34;</span><span class=p>:</span><span class=s2>&#34;my.span.attr&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some value&#34;</span><span class=p>}}]}]}]}]}</span></span></span></code></pre></div></div></div><div data-tab-item=formatted-json class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;service.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;password_check&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;security_applications&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;my.library&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some scope attribute&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;spans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;5B8EFFF798038103D269B633813FC60C&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;EEE19B7EC3C1B174&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span> <span class=s2>&#34;EEE19B7EC3C1B173&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;keytest&#34;</span><span class=p>:</span> <span class=s2>&#34;my.span.attr&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some value&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div></div></details><h3 id=testing-the-routing-scenario>Testing the routing scenario</h3><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Before proceeding, ensure that there are no <code>*.out</code> files in the <code>[WORKSHOP]/8-routing</code> directory.</p><ul><li><p><strong>Send a Regular Span</strong>:</p><ol><li>Open your test terminal and navigate to the <code>[WORKSHOP]/8-routing</code> directory.</li><li>Send a regular span using the <code>trace.json</code> file to confirm proper communication.</li></ol><p>Both the <strong>Agent</strong> and <strong>Gateway</strong> should display debug information, including the span you just sent. The gateway will also generate a new <code>gateway-traces-standard.out</code> file, as this is now the designated destination for regular spans.</p></li></ul><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>If you check <code>gateway-traces-standard.out</code>, it should contain the <code>span</code> sent using the <code>cURL</code> command. You will also see an empty <code>gateway-traces-security.out</code> file, as the routing configuration creates output files immediately, even if no matching spans have been processed yet.</p></div></details><ul><li><strong>Send a Security Span</strong>:<ol><li>Ensure both the <strong>Agent</strong> and <strong>Gateway</strong> are running.</li><li>Send a security span using the <code>security.json</code> file to test the gateway’s routing rule.</li></ol></li></ul><p>Again, both the <strong>Agent</strong> and <strong>Gateway</strong> should display debug information, including the span you just sent. This time, the <strong>Gateway</strong> will write a line to the <code>gateway-traces-security.out</code> file, which is designated for spans where the <code>deployment.environment</code> resource attribute matches <code>"security_applications"</code>.
The <code>gateway-traces-standard.out</code> should be unchanged.</p><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>If you verify the <code>./gateway-traces-security.out</code> it should only contain the spans from the <code>"security_applications"</code> deployment.environment.</p></div></details><p>You can repeat this scenario multiple times, and each trace will be written to its corresponding output file.</p></div></details><h3 id=conclusion>Conclusion</h3><p>In this section, we successfully tested the routing connector in the gateway by sending different spans and verifying their destinations.</p><ul><li><p><strong>Regular spans</strong> were correctly routed to <code>gateway-traces-default.out</code>, confirming that spans without a matching <code>deployment.environment</code> attribute follow the default pipeline.</p></li><li><p><strong>Security-related spans</strong> from <code>security.json</code> were routed to <code>gateway-traces-security.out</code>, demonstrating that the routing rule based on <code>"deployment.environment": "security_applications"</code> works as expected.</p></li></ul><p>By inspecting the output files, we confirmed that the OpenTelemetry Collector <em>correctly evaluates span attributes and routes them to the appropriate destinations</em>. This validates that routing rules can effectively separate and direct telemetry data for different use cases.</p><p>You can now extend this approach by defining additional routing rules to further categorize spans, metrics, and logs based on different attributes.</p><p>Stop the <strong>Agent</strong>, <strong>Gateway</strong> and the <strong>quotes generating script</strong>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 5, 2025</span></span></footer></article></section></div></main></div><script src=/observability-workshop/v5.78/js/clipboard.min.js?1738773632 defer></script><script src=/observability-workshop/v5.78/js/perfect-scrollbar.min.js?1738773632 defer></script><script src=/observability-workshop/v5.78/js/d3/d3-color.min.js?1738773632 defer></script><script src=/observability-workshop/v5.78/js/d3/d3-dispatch.min.js?1738773632 defer></script><script src=/observability-workshop/v5.78/js/d3/d3-drag.min.js?1738773632 defer></script><script src=/observability-workshop/v5.78/js/d3/d3-ease.min.js?1738773632 defer></script><script src=/observability-workshop/v5.78/js/d3/d3-interpolate.min.js?1738773632 defer></script><script src=/observability-workshop/v5.78/js/d3/d3-selection.min.js?1738773632 defer></script><script src=/observability-workshop/v5.78/js/d3/d3-timer.min.js?1738773632 defer></script><script src=/observability-workshop/v5.78/js/d3/d3-transition.min.js?1738773632 defer></script><script src=/observability-workshop/v5.78/js/d3/d3-zoom.min.js?1738773632 defer></script><script src=/observability-workshop/v5.78/js/js-yaml.min.js?1738773632 defer></script><script src=/observability-workshop/v5.78/js/mermaid.min.js?1738773632 defer></script><script>window.themeUseMermaid=JSON.parse("{}")</script><script src=/observability-workshop/v5.78/js/theme.js?1738773632 defer></script></body></html>